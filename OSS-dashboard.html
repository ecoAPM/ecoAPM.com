---
---

<script src="/lib/marked.min.js"></script>
<script src="/lib/vue.global.prod.js"></script>

<style>
    h2 {
        margin-top: 1rem;
    }

    img {
        max-width: revert;
    }
</style>

<div class="container-fluid">
    <h2>OSS Dashboard</h2>
    <table class="table table-bordered table-hover table-striped table-responsive-xl">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Version</th>
                <th scope="col">Issues</th>
                <th scope="col">PRs</th>
                <th scope="col">CI</th>
                <th scope="col">Coverage</th>
                <th scope="col">Maintainability</th>
                <th scope="col">Reliability</th>
                <th scope="col">Security</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="info in data">
                <th scope="row" v-html="render(link(info))"></th>
                <td v-html="render(versionBadge(info))"></td>
                <td v-html="render(issueBadge(info))"></td>
                <td v-html="render(prBadge(info))"></td>
                <td v-html="render(ciBadge(info))"></td>
                <td v-html="render(coverageBadge(info))"></td>
                <td v-html="render(maintainabilityBadge(info))"></td>
                <td v-html="render(reliabilityBadge(info))"></td>
                <td v-html="render(securityBadge(info))"></td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    const codeURL = (name) => `https://github.com/ecoAPM/${name}`;

    const versionBadgeURL = (info) => `https://img.shields.io/${packageManager(info.type)}/v/${info.package}?logo=${packageManager(info.type)}&label=Version`;

    const packageManager = (type) => {
        switch (type) {
            case '.NET':
                return 'nuget';
            case 'Node':
                return 'npm'
            default:
                return '';
        }
    };

    const packageURL = (info) => `https://${packageManagerURL(info.type)}/${info.package}`;

    const packageManagerURL = (type) => {
        switch (type) {
            case '.NET':
                return 'nuget.org/packages';
            case 'Node':
                return 'npmjs.com/package'
            default:
                return '';
        }
    };

    const issueBadgeURL = (name) => `https://img.shields.io/github/issues-raw/ecoAPM/${name}?logo=GitHub&label=Issues`;
    const issueURL = (name) => `${codeURL(name)}/issues`;

    const prBadgeURL = (name) => `https://img.shields.io/github/issues-pr-raw/ecoAPM/${name}?logo=GitHub&label=PRs`;
    const prURL = (name) => `${codeURL(name)}/pulls`;

    const ciBadgeURL = (name) => `${codeURL(name)}/workflows/CI/badge.svg`;
    const ciURL = (name) => `${codeURL(name)}/actions`;

    const coverageBadgeURL = (name) => qualityBadgeURL(name, 'coverage');
    const maintainabilityBadgeURL = (name) => qualityBadgeURL(name, 'sqale_rating');
    const reliabilityBadgeURL = (name) => qualityBadgeURL(name, 'reliability_rating');
    const securityBadgeURL = (name) => qualityBadgeURL(name, 'security_rating');

    const qualityBadgeURL = (name, type) => `https://sonarcloud.io/api/project_badges/measure?project=ecoAPM_${name}&metric=${type}`;
    const qualityURL = (name) => `https://sonarcloud.io/dashboard?id=ecoAPM_${name}`;

    const app = {
        data: () => ({
            data: [
                {
                    name: "LoadTestToolbox",
                    package: "LoadTestToolbox",
                    type: ".NET"
                },
                {
                    name: "xunit.ts",
                    package: "xunit.ts",
                    type: "Node"
                },
                {
                    name: "BenchmarkMockNet",
                    type: ".NET",
                    CI: false,
                    quality: false,
                    tests: false
                },
                {
                    name: "NotoSans",
                    package: "notosans",
                    type: "Node",
                    tests: false
                },
                {
                    name: "TompkinsCOVID",
                    type: ".NET"
                }
            ]
        }),
        methods: {
            render: (data) => marked(data),
            link: (info) => `[${info.name}](${codeURL(info.name)})`,
            versionBadge: (info) => info.package ? `[![Version](${versionBadgeURL(info)})](${packageURL(info)})` : '',
            ciBadge: (info) => info.CI ?? true ? `[![CI](${ciBadgeURL(info.name)})](${ciURL(info.name)})` : '',
            issueBadge: (info) => `[![Issues](${issueBadgeURL(info.name)})](${issueURL(info.name)})`,
            prBadge: (info) => `[![PRs](${prBadgeURL(info.name)})](${prURL(info.name)})`,
            coverageBadge: (info) => info.tests ?? true ? `[![Coverage](${coverageBadgeURL(info.name)})](${qualityURL(info.name)})` : '',
            maintainabilityBadge: (info) => info.quality ?? true ? `[![Maintainability](${maintainabilityBadgeURL(info.name)})](${qualityURL(info.name)})` : '',
            reliabilityBadge: (info) => info.quality ?? true ? `[![Reliability](${reliabilityBadgeURL(info.name)})](${qualityURL(info.name)})` : '',
            securityBadge: (info) => info.quality ?? true ? `[![Security](${securityBadgeURL(info.name)})](${qualityURL(info.name)})` : ''
        }
    };
    Vue.createApp(app).mount('table');
</script>